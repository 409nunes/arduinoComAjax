<!DOCTYPE HTML>
<html>
	<head>
		<title>Arduino com AJAX</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	</head>

<body>

<div>
	<h1>Arduino com AJAX</h1>
	<p>
		Lendo dois sensores no arduino. confira o codigo no github: <a href="https://github.com/rogerin/ArduinoComAjax">rogerin</a> <br/>
		Projeto sem uma boa interface grafica, pois não é o foco dessa demonstração.
	</p>
	<p>
		Status: <span id="status">...</span>
	</p>
	<p>
		<h2>Sensor 1</h2>
		Valor: <strong><span id="sensor1"></span></strong>
	</p>
	<p>
		<h2>Sensor 2</h2>
		Valor: <strong><span id="sensor2"></span></strong>
	</p>

</div>

<script type="text/javascript">

//var url = 'http://192.168.1.100:3000';
var url = '127.0.0.1';


$(document).ready(function(){

	// Faz a primeira requisição quando a página é carregada
	fazerRequisicao(); 
	function fazerRequisicao(){
		$('#status').text("Enviando Requisição...");
    	$.ajax({
		    url: url,
		    data: { '': ''}, // usaremos em proximas versões
		    dataType: 'jsonp', // IMPORTANTE
		    crossDomain: true, // IMPORTANTE
		    jsonp: false,
		    jsonpCallback: 'dados', // IMPORTANTE
		    success: function(data,status,xhr) {
				$('#status').text("Requisição Recebida!");
				$('#sensor1').text(data.sensor1);
				$('#sensor2').text(data.sensor2);
				console.log(data);
		    }
		  });
        return false;
    }

    // A cada 1000 (1 segundo), faça uma nova requisição.
    setInterval(fazerRequisicao, 1000);
  	// Acredito que 3000 (3 segundos) ou mais seja o ideal.
 	
});

</script>
</body>
</html>